# HIP-01: Key Generation and Identity

`draft` `mandatory`

This document specifies the key generation and identity system for Hengdang protocol.

## Abstract

Hengdang uses hierarchical deterministic (HD) keys derived from BIP39 mnemonics. This specification defines the cryptographic standards for generating and managing user keys.

## Specification

### 1. Mnemonic Generation
- Use BIP39 to generate a 24-word mnemonic from 256 bits of entropy
- Language: English word list
- Checksum: Last 8 bits of the SHA256 hash of the initial entropy
- Total entropy: 256 bits (24 words)

### 2. Seed Generation
- Use BIP39 seed generation: PBKDF2(mnemonic, salt)
- Salt: "mnemonic" + optional passphrase
- PBKDF2 parameters:
  - Hash function: SHA512
  - Iterations: 2048
  - Output length: 512 bits

### 3. Key Derivation
- Use BIP32 for hierarchical deterministic key generation
- Curve: secp256k1
- Derivation path: m/44'/65535'/0'/0/0
  - Purpose: 44' (BIP44)
  - Coin type: 65535' (Hengdang)
  - Account: 0'
  - Change: 0
  - Index: 0

### 4. Public Key Format
- Use compressed secp256k1 public keys (33 bytes)
- First byte: 0x02 or 0x03 (compression prefix)
- Remaining 32 bytes: x-coordinate
- y-coordinate: derived from x using secp256k1 curve equation

### 5. HPUB Encoding
- Use Bech32 encoding for human-readable public keys
- Prefix: "hpub1"
- Data: Compressed public key bytes
- Checksum: 6 characters using Bech32 polynomial

## Examples

### Mnemonic Generation
```
abandon abandon abandon abandon abandon abandon
abandon abandon abandon abandon abandon about
```

### Derivation Path Components
```
m / 44' / 65535' / 0' / 0 / 0
│   │      │      │    │   └── Address index
│   │      │      │    └────── Change (0 = external)
│   │      │      └─────────── Account index
│   │      └──────────────────── Hengdang coin type
│   └─────────────────────────── BIP44 purpose
└─────────────────────────────── Master node
```

### HPUB Format
```
hpub1<base32-encoded-public-key><6-char-checksum>
```

## Security Considerations

1. **Entropy Source**
   - Must use cryptographically secure random number generator
   - Minimum 256 bits of entropy for mnemonic
   - Verify entropy source quality

2. **Key Storage**
   - Never store private keys or mnemonics unencrypted
   - Use secure key derivation for encryption
   - Consider hardware security modules

3. **Implementation Requirements**
   - Validate mnemonics before use
   - Check key derivation results
   - Verify public key compression

## Test Vectors

### Test Vector 1
```
Mnemonic (24 words):
abandon abandon abandon abandon abandon abandon
abandon abandon abandon abandon abandon about

Master seed (hex):
5eb00bbddcf069084889a8ab9155568165f5c453ccb85e70811aaed6f6da5fc19a5ac40b389cd370d086206dec8aa6c43daea6690f20ad3d8d48b2d2ce9e38e4

Derived private key (hex):
1837c1be8e2995ec11cda2b066151be2cfb48adf9e47b151d46adab3a21cdf67

Compressed public key (hex):
02dff1d77f2a671c5f36183726db2341be58feae1da2deced843240f7b502ba659

HPUB:
hpub1f2jfhqmxcjhz9k5jc4h8zj6c8w9gf0v3s5q2m7x8y9n3p4r5t6v7w8x9y
```

## References

1. [BIP39 Specification](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki)
2. [BIP32 Specification](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki)
3. [BIP44 Specification](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki)
4. [secp256k1](https://www.secg.org/sec2-v2.pdf)
5. [Bech32 Specification](https://github.com/bitcoin/bips/blob/master/bip-0173.mediawiki)
